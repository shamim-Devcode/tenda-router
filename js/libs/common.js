function getRandom(){return"?random="+Math.random()}var statusMsg={"0101":_("WAN port unplugged! Please plug the Internet cable into it"),"0102":_("Disconnected"),"0103":_("Connecting...Detecting the Internet..."),"0104":_("Connected...Accessing the Internet..."),"0105":_("Can not surf the Internet. Please contact your ISP!"),"0106":_("You can surf the Internet"),"0201":_("WAN port unplugged! Please plug the Internet cable into it"),"0202":_("Disconnected"),"0203":_("Connecting...Detecting the Internet..."),"0204":_("Connected...Accessing the Internet..."),"0205":_("The router has obtained a valid IP address but cannot access the Internet. Please try the solutions below one by one.")+"<br/>1. <a id='cloneMac' style='text-decoration:underline;' class='text-success' href='javascript:void(0)'>"+_("Clone MAC address")+"</a>"+_("(MAC Clone will take effect in 30 seconds.)")+"<br/>"+_("2. Try another computer and reconfigure the router")+"<br/>"+_("3. Please make sure you have applied a valid Internet service. If not, consult your ISP for help"),"0206":_("You can surf the Internet"),"0207":_("IP conflict! Please modify LAN IP"),"0208":_("ERROR: No response from the remote server. Please contact your ISP for help"),"0301":_("WAN port unplugged! Please plug the Internet cable into it"),"0302":_("Disconnected"),"0303":_("Checking the user name and password... Please wait. It will take 1~5 minutes"),"0304":_("Dial-up Successfully...Accessing the Internet..."),"0305":_("Dial-up Successfully,but can not surf the Internet. Please contact your ISP!"),"0306":_("You can surf the Internet"),"0307":_("Failed! Please confirm your user name and password and try again"),"0308":_("ERROR: No response from the remote server. Please contact your ISP for help"),"1102":_("No bridge yet in WISP mode."),"1103":_("Bridging in WISP mode..."),"1104":_("Bridged successfully in WISP mode. Trying accessing the Internet..."),"1105":_("Can not surf the Internet. Please contact your ISP!"),"1106":_("Connected! You can surf the Internet."),"1107":_("The WiFi password of the base station is incorrect."),"1202":_("No bridge yet in WISP mode."),"1203":_("Bridging in WISP mode..."),"1204":_("Bridged successfully in WISP mode. Trying accessing the Internet..."),"1205":_("Get an IP Successfully,but can not surf the Internet. Please contact your ISP!"),"1206":_("Connected! You can surf the Internet."),"1207":_("IP conflict! Please modify LAN IP"),"1208":_("ERROR: No response from the remote server. Please contact your ISP for help"),"1209":_("The WiFi password of the base station is incorrect."),"1302":_("No bridge yet in WISP mode."),"1303":_("Checking the user name and password... Please wait. It will take 1~5 minutes"),"1304":_("Dial-up Successfully...Accessing the Internet..."),"1305":_("Dial-up Successfully,but can not surf the Internet. Please contact your ISP!"),"1306":_("You can surf the Internet"),"1307":_("Failed! Please confirm your user name and password and try again"),"1308":_("ERROR: No response from the remote server. Please contact your ISP for help"),"1309":_("The WiFi password of the base station is incorrect."),"2102":_("No bridge yet in Universal Repeater mode."),"2103":_("Bridging in Universal Repeater mode..."),"2104":_("Bridged successfully in Universal Repeater mode."),"2202":_("No bridge yet in Universal Repeater mode."),"2203":_("Bridging in Universal Repeater mode..."),"2204":_("Bridged successfully in Universal Repeater mode."),"2302":_("No bridge yet in Universal Repeater mode."),"2303":_("Bridging in Universal Repeater mode..."),"2304":_("Bridged successfully in Universal Repeater mode."),"2107":_("The WiFi password of the base station is incorrect."),"2209":_("The WiFi password of the base station is incorrect."),"2309":_("The WiFi password of the base station is incorrect.")};var lanWanIPConflict=false;function updateInternetConnectStatus(obj,elemID){if(!lanWanIPConflict){if(obj.lanWanIPConflict=="true"){lanWanIPConflict=true;alert(_("IP conflict! The login IP address will be changed into %s automatically.Please log in again using %s.",[obj.newLanIP,obj.newLanIP]));progressLogic.init("","reboot",180,obj.newLanIP)}else{showWanInternetStatus(obj.wanConnectStatus,elemID)}}function showWanInternetStatus(statusCode,elemID){var str="",connectStatus,connectMsg;if(!statusCode){return false}connectStatus=statusCode.slice(1,2);connectMsg=statusCode.slice(3,7);if(connectStatus=="3"){str="text-success"}else{if(connectStatus=="2"){str="text-primary"}else{str="text-danger"}}$("#"+elemID).html(statusMsg[connectMsg]).attr("class",str);return true}}function checkIpInSameSegment(ip_lan,mask_lan,ip_wan,mask_wan){if(ip_lan===""||ip_wan===""){return false}var ip1Arr=ip_lan.split("."),ip2Arr=ip_wan.split("."),maskArr1=mask_lan.split("."),maskArr2=mask_wan.split("."),maskArr=maskArr1,i;for(i=0;i<4;i++){if(maskArr1[i]!=maskArr2[i]){if((maskArr1[i]&maskArr2[i])==maskArr1[i]){maskArr=maskArr1}else{maskArr=maskArr2}break}}for(i=0;i<4;i++){if((ip1Arr[i]&maskArr[i])!=(ip2Arr[i]&maskArr[i])){return false}}return true}function checkIsVoildIpMask(ip,mask,str){var ipArry,maskArry,len,maskArry2=[],netIndex=0,netIndex1=0,broadIndex=0,i=0;str=str||_("IP Address");ipArry=ip.split("."),maskArry=mask.split("."),len=ipArry.length;for(i=0;i<len;i++){maskArry2[i]=255-Number(maskArry[i])}for(var k=0;k<4;k++){if((ipArry[k]&maskArry[k])==0){netIndex1+=0}else{netIndex1+=1}}for(var k=0;k<4;k++){if((ipArry[k]&maskArry2[k])==0){netIndex+=0}else{netIndex+=1}}if(netIndex==0||netIndex1==0){return _("%s can't be the network segment.",[str])}for(var j=0;j<4;j++){if((ipArry[j]|maskArry[j])==255){broadIndex+=0}else{broadIndex+=1}}if(broadIndex==0){return _("%s can't be the broadcast address.",[str])}return}function objToString(obj){var str="",prop;for(prop in obj){str+=prop+"="+encodeURIComponent(obj[prop])+"&"}str=str.replace(/[&]$/,"");return str}function inputValue(obj,callback){var prop,tagName;for(prop in obj){if(prop&&$("#"+prop).length>0){tagName=document.getElementById(prop).tagName.toLowerCase();switch(tagName){case"input":case"select":if(document.getElementById(prop).type=="checkbox"){if(obj[prop]=="true"){document.getElementById(prop).checked=true}else{document.getElementById(prop).checked=false}}else{$("#"+prop).val(obj[prop])}break;default:if($("#"+prop).hasClass("textboxs")||$("#"+prop).hasClass("input-append")){$("#"+prop)[0].val(obj[prop])}else{$("#"+prop).text(obj[prop])}break}}else{if(prop&&$("[name='"+prop+"']").length>1){tagName=document.getElementsByName(prop)[0].tagName.toLowerCase();if(tagName==="input"){if($("[name='"+prop+"'][value='"+obj[prop]+"']").length>0){$("[name='"+prop+"'][value='"+obj[prop]+"']")[0].checked=true}}}}}if(typeof callback=="function"){callback.apply()}}function formatSeconds(value){var theTime=parseInt(value);var theTime1=0;var theTime2=0;var theTime3=0;if(theTime>60){theTime1=parseInt(theTime/60);theTime=parseInt(theTime%60);if(theTime1>60){theTime2=parseInt(theTime1/60);theTime1=parseInt(theTime1%60);if(theTime2>24){theTime3=parseInt(theTime2/24);theTime2=parseInt(theTime2%24)}}}var result=""+parseInt(theTime)+_("s");if(theTime1>0){result=""+parseInt(theTime1)+_("m")+" "+result}if(theTime2>0){result=""+parseInt(theTime2)+_("h")+" "+result}if(theTime3>0){result=""+parseInt(theTime3)+_("d")+" "+result}return result}function Encode(){var base64EncodeChars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function utf16to8(str){var out,i,len,c;out="";len=str.length;for(i=0;i<len;i++){c=str.charCodeAt(i);if((c>=1)&&(c<=127)){out+=str.charAt(i)}else{if(c>2047){out+=String.fromCharCode(224|((c>>12)&15));out+=String.fromCharCode(128|((c>>6)&63));out+=String.fromCharCode(128|((c>>0)&63))}else{out+=String.fromCharCode(192|((c>>6)&31));out+=String.fromCharCode(128|((c>>0)&63))}}}return out}function base64encode(str){var out,i,len;var c1,c2,c3;len=str.length;i=0;out="";while(i<len){c1=str.charCodeAt(i++)&255;if(i==len){out+=base64EncodeChars.charAt(c1>>2);out+=base64EncodeChars.charAt((c1&3)<<4);out+="==";break}c2=str.charCodeAt(i++);if(i==len){out+=base64EncodeChars.charAt(c1>>2);out+=base64EncodeChars.charAt(((c1&3)<<4)|((c2&240)>>4));out+=base64EncodeChars.charAt((c2&15)<<2);out+="=";break}c3=str.charCodeAt(i++);out+=base64EncodeChars.charAt(c1>>2);out+=base64EncodeChars.charAt(((c1&3)<<4)|((c2&240)>>4));out+=base64EncodeChars.charAt(((c2&15)<<2)|((c3&192)>>6));out+=base64EncodeChars.charAt(c3&63)}return out}return function(s){return base64encode(utf16to8(s))}}if(window.JSON){$.parseJSON=JSON.parse}function checkIsTimeOut(str){if(str.indexOf("<!DOCTYPE")!=-1){return true}return false}function addOverLay(time){time=time||0;var str="<div class='save-overlay'></div>";$("body").append(str);setTimeout(function(){$(".save-overlay").remove()},time)}function isEmptyObject(obj){var name;for(name in obj){return false}return true}function PageLogic(urlObj){var moduleArry;var _this=this;this.init=function(){moduleArry=this.modules;this.pageRunning=true;this.initEvent();for(var i=0;i<moduleArry.length;i++){if(typeof moduleArry[i].init=="function"){moduleArry[i].init()}}this.addValidate();this.getValue(urlObj.getUrl,urlObj.modules)};this.initEvent=function(){};this.reCancel=function(){_this.initValue(_this.data)};this.updateTimer=null;this.update=function(modules,time,callback){time=time||0;if(!_this.pageRunning||time==0){clearTimeout(this.updateTimer);return}clearTimeout(this.updateTimer);if(time!=0){this.updateTimer=setTimeout(function(){_this.update(modules,time,callback)},time)}if(typeof urlObj.getUrl=="string"){$.get(urlObj.getUrl+"?"+Math.random()+"&modules="+encodeURIComponent(modules),function(obj){if(checkIsTimeOut(obj)){top.location.reload(true)}try{obj=$.parseJSON(obj)}catch(e){obj={}}if(isEmptyObject(obj)){top.location.reload(true)}if(!_this.pageRunning){return}if(typeof callback=="function"){callback.apply(this,[obj])}})}};this.getValue=function(getUrl,modules){var obj={};if(!this.pageRunning){return}if(typeof getUrl=="string"){var tmpObj={},data="";if(modules){data=$.encodeFormData({random:Math.random(),modules:modules})}else{data=Math.random()}$.get(getUrl+"?"+data,_this.initValue)}};this.initValue=function(obj){var moduleName,i;if(typeof obj=="string"){if(checkIsTimeOut(obj)){top.location.reload(true)}try{obj=$.parseJSON(obj)}catch(e){obj={}}}if(isEmptyObject(obj)){top.location.reload(true)}_this.data=obj;if(!_this.pageRunning){return}for(i=0;i<moduleArry.length;i++){moduleName=moduleArry[i].moduleName;if(typeof moduleArry[i].initValue=="function"){moduleArry[i].initValue(_this.data[moduleName])}}if(mainLogic&&typeof mainLogic=="object"){mainLogic.initModuleHeight()}};this.getSubmitData=function(){var data="";for(var i=0;i<moduleArry.length;i++){if(typeof moduleArry[i].getSubmitData=="function"){data+=moduleArry[i].getSubmitData()+"&"}}data=data.replace(/[&]$/,"");return data};this.addValidate=function(){this.validate=$.validate({custom:function(){var msg;for(var i=0;i<moduleArry.length;i++){if(typeof moduleArry[i].checkData=="function"){msg=moduleArry[i].checkData.apply()}if(msg){return msg}}},success:function(){_this.preSubmit()},error:function(msg){if(msg){_this.showPageMsg(msg)}}})};this.preSubmit=function(){if(typeof _this.beforeSubmit=="function"){if(!_this.beforeSubmit()){return}}var data=_this.getSubmitData();addOverLay(1000);mainLogic.showModuleMsg(_("Saving..."));$.ajax({url:urlObj.setUrl,type:"POST",data:data,success:_this.successCallback,error:_this.ajaxErrMsg})};this.successCallback=function(msg){if(checkIsTimeOut(msg)){top.location.reload(true);return}var num=$.parseJSON(msg).errCode||"-1";var ip=_this.rebootIP||"";if(+num==0){mainLogic.showModuleMsg(_("Saved successfully!"));_this.getValue(urlObj.getUrl,urlObj.modules)}else{if(num=="2"){mainLogic.showModuleMsg(_("Fail to change password! Old Password is not correct."))}else{if(num=="100"){progressLogic.init("","reboot",200,ip)}else{if(num=="101"){window.location="./login.html"}}}}$("#submit").removeAttr("disabled")};this.ajaxErrMsg=function(){_this.showPageMsg(_("Upload data error!"))};this.showPageMsg=function(msg){mainLogic.showModuleMsg(msg);return}}function isAllNumber(arry){var i=0,len=arry.length||0;for(i=0;i<len;i++){if(isNaN(Number(arry[i]))){return false}}return true}function isAllIp(arry){var i=0,len=arry.length||0;for(i=0;i<len;i++){if(!(/^([1-9]|[1-9]\d|1\d\d|2[0-1]\d|22[0-3])\.(([0-9]|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.){2}([0-9]|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])$/).test(arry[i])){return false}}return true}function isAllMac(arry){var i=0,len=arry.length||0;for(i=0;i<len;i++){if(!(/^([0-9a-fA-F]{2}:){5}[0-9a-fA-F]{2}$/).test(arry[i])){return false}}return true}function reCreateObj(obj,prop,sortTag){var newObj=[],len=obj.length||0,i=0,j=0,newArry=[],arry_prop=[],temporaryObj=[],numberFlag=false,ipFlag=false,macFlag=false;for(var k=0;k<len;k++){temporaryObj[k]=obj[k]}for(i=0;i<len;i++){arry_prop[i]=temporaryObj[i][prop]}numberFlag=isAllNumber(arry_prop);ipFlag=isAllIp(arry_prop);macFlag=isAllMac(arry_prop);function sortNumber(a,b){var c=parseInt(a.replace(/[.:]/g,""),16);var d=parseInt(b.replace(/[.:]/g,""),16);return c-d}if(numberFlag||ipFlag||macFlag){newArry=arry_prop.sort(sortNumber)}else{newArry=arry_prop.sort()}for(i=0;i<len;i++){for(j=0;j<temporaryObj.length;j++){if(newArry[i]==temporaryObj[j][prop]){newObj.push(temporaryObj[j]);temporaryObj.splice(j,1);break}}}if(sortTag=="up"){return newObj}else{return newObj.reverse()}}$.include({removeValidateTipError:function(valid){return this.each(function(){var $tipElem=$("#"+this.validateTipId);if(!$tipElem){return}$("#"+this.validateTipId).parent().removeClass("has-error").removeClass("has-feedback");$("#"+this.validateTipId).remove();this.validateTipId=""})}});function showDialog(Id,width,height){if(!$("#progress-overlay").hasClass("in")){$("#progress-overlay").addClass("in")}$("#"+Id).removeClass("none");$(".main-dialog").css("top","20%")}function closeIframe(dialogId){$("#"+dialogId).addClass("none");$("#progress-overlay").removeClass("in")}function getStrByteNum(str){var totalLength=0,charCode;for(var i=str.length-1;i>=0;i--){charCode=str.charCodeAt(i);if(charCode<=127){totalLength++}else{if((charCode>=128)&&(charCode<=2047)){totalLength+=2}else{if((charCode>=2048)&&(charCode<=65535)){totalLength+=3}else{totalLength+=4}}}}return totalLength};